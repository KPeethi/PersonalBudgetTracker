{% extends "base.html" %}

{% block title %}Expense Tracker - Monthly Summary{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">Monthly Summary</h5>
                <a href="{{ url_for('dashboard') }}" class="btn btn-sm btn-outline-secondary">View Dashboard</a>
            </div>
            <div class="card-body">
                {% if summaries %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Year</th>
                                    <th>Total Expenses</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for summary in summaries %}
                                <tr>
                                    <td>{{ summary.month }}</td>
                                    <td>{{ summary.year }}</td>
                                    <td>${{ "%.2f"|format(summary.total_amount) }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="alert alert-info">
                        No expenses found. Add some expenses to see monthly summaries.
                    </div>
                {% endif %}
            </div>
        </div>
        
        <div class="mt-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Insights</h5>
                </div>
                <div class="card-body">
                    {% if summaries|length > 1 %}
                        {% set current_month = summaries[0] %}
                        {% set prev_month = summaries[1] %}
                        {% set pct_change = ((current_month.total_amount - prev_month.total_amount) / prev_month.total_amount * 100)|round(1) %}
                        
                        <div class="alert {% if pct_change > 0 %}alert-danger{% elif pct_change < 0 %}alert-success{% else %}alert-info{% endif %}">
                            {% if pct_change > 0 %}
                                Your expenses in {{ current_month.month }} {{ current_month.year }} increased by {{ pct_change }}% compared to {{ prev_month.month }} {{ prev_month.year }}.
                            {% elif pct_change < 0 %}
                                Your expenses in {{ current_month.month }} {{ current_month.year }} decreased by {{ (pct_change * -1)|round(1) }}% compared to {{ prev_month.month }} {{ prev_month.year }}.
                            {% else %}
                                Your expenses in {{ current_month.month }} {{ current_month.year }} remained the same as {{ prev_month.month }} {{ prev_month.year }}.
                            {% endif %}
                        </div>
                        
                        {% if summaries|length > 3 %}
                            {% set avg_three_months = ((summaries[0].total_amount + summaries[1].total_amount + summaries[2].total_amount) / 3)|round(2) %}
                            <div class="alert alert-info">
                                Your average monthly expense for the last 3 months is ${{ "%.2f"|format(avg_three_months) }}.
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="alert alert-info">
                            Add expenses for multiple months to see trending insights.
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}